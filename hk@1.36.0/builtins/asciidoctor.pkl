import "../Builtins.pkl"
import "../Config.pkl"
import "./test/helpers.pkl"

@Builtins.meta {
  category = "AsciiDoc"
  description = "AsciiDoc syntax validator and processor"
}
const asciidoctor = new Config.Step {
  types = List("asciidoc")
  // The `failure-level` option ensures non-zero exit code when warnings occur
  // The `out-file=/dev/null` option prevents HTML file generation
  check = "asciidoctor --failure-level=WARNING --out-file=/dev/null {{ files }}"
  tests {
    local const testMaker = new helpers.TestMaker {
      filename = "test.adoc"
    }
    ["check bad file"] =
      testMaker.checkFail(
        """
        ----
        Unclosed source code block
        """,
        1,
      )
    ["check good file"] =
      testMaker.checkPass(
        """
        ----
        Closed source code block
        ----
        """,
      )
  }
}
